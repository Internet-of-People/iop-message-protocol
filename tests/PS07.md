### PS07xxx - Related Identities Related Functionality Tests

#### PS07001 - Add/Remove/Get Related Identity

##### Prerequisites/Inputs

###### Prerequisites:
  * Server's database is empty.

###### Inputs:
  * Server's IP address
  * Server's primary port


##### Description 

The test adds, removes and queries related identities to its profile.


###### Step 1:

The tests obtains a list of service ports from the profile server's primary port.
The test creates a primary identity and a secondary, for which it establishes hosting agreements and checks them in.
Then it creates 5 other identities (Identity1 to Identity5), which it uses for issuing relationship cards.


###### Step 2:

Using the primary checked-in identity, the test sends *AddRelatedIdentityRequest* with what we call $Card1:

  * `Message.id := 3`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity1
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity1
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [1]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card2):

  * `Message.id := 4`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 1479220557000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity1
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity1
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [2]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card3):

  * `Message.id := 5`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity2
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity2
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [3]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card4):

  * `Message.id := 6`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 2479220555000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity2
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity2
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [4]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card5):

  * `Message.id := 7`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type B"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity3
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity3
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [5]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card6):

  * `Message.id := 8`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type B"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity4
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity4
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [6]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card7):

  * `Message.id := 9`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type C"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity4
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity4
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [7]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card8):

  * `Message.id := 10`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type C"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity4
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity4
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [8]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. Then it sends *AddRelatedIdentityRequest* ($Card9):

  * `Message.id := 11`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Other"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity5
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity5
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [9]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response. 

###### Step 3:

Using the secondary checked-in identity, the test sends *AddRelatedIdentityRequest* ($Card10):

  * `Message.id := 3`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Identity1
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's secondary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Identity1
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [1]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`

and reads the response.



###### Step 4:

Using the secondary identity, it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 4`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := ""`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 5`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := false`
  * `GetIdentityRelationshipsInformationRequest.type := ""`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 6`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 7`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "**"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 8`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "Card*"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 9`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*Type A"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 10`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*Type *"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 11`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := ""`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := true`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is Identity1 ID

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 12`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*C"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := true`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is Identity4 ID

and reads the response.



###### Step 5:


Using the first identity, it sends *RemoveRelatedIdentityRequest*:

  * `Message.id := 12`
  * `RemoveRelatedIdentityRequest.applicationId := [2]`

and reads the response. Then it sends *RemoveRelatedIdentityRequest*:

  * `Message.id := 13`
  * `RemoveRelatedIdentityRequest.applicationId := [4]`

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 14`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*Type a*"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 15`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to first 10 bytes of the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type := "*Type a*"`
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response.

  
##### Acceptance Criteria


###### Step 1:

The test successfully obtains list of ports on which the profile server provides its services. 
Then the test successfully establishes hosting agreements for its primary and secondary identities.
Then the test successfully checks-in both identities.


###### Step 2:

Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 3`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 4`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 5`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 6`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 7`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 8`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 9`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 10`
  * `Response.status == STATUS_OK`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 11`
  * `Response.status == STATUS_OK`



###### Step 3:

Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 3`
  * `Response.status == STATUS_OK`


###### Step 4:

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 4`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4, $Card5, $Card6, $Card7, $Card8, $Card9,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 5`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card3, $Card5, $Card6, $Card7, $Card8, $Card9,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 6`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4, $Card5, $Card6, $Card7, $Card8, $Card9,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 7`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4, $Card5, $Card6, $Card7, $Card8, $Card9,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 8`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4, $Card5, $Card6, $Card7, $Card8,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 9`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 10`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2, $Card3, $Card4, $Card5, $Card6, $Card7, $Card8,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 11`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card2,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 12`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card7, $Card8,
    )`


###### Step 5:

Server replies with *RemoveRelatedIdentityResponse*:

  * `Message.id := 12`
  * `Response.status == STATUS_OK`

Server replies with *RemoveRelatedIdentityResponse*:

  * `Message.id := 13`
  * `Response.status == STATUS_OK`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 14`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == 
    (
      $Card1, $Card3,
    )`

Server replies with *GetIdentityRelationshipsInformationResponse*:

  * `Message.id := 15`
  * `Response.status == STATUS_OK`
  * `SingleResponse.version == [1,0,0]`
  * `GetIdentityRelationshipsInformationResponse.relationships == ()`











#### PS07002 - Add/Remove/Get Related Identity - Invalid Requests

##### Prerequisites/Inputs

###### Prerequisites:
  * Server's database is empty.

###### Inputs:
  * Server's IP address
  * Server's primary port


##### Description 

The test checks error handling for invalid requests to add, remove and query related identities.


###### Step 1:

The tests obtains a list of service ports from the profile server's primary port.
The test creates a primary identity, for which it establishes a hosting agreement and checks it in.
Then it creates another identities (called Issuer), which it uses for issuing relationship cards.


###### Step 2:

The test sends *AddRelatedIdentityRequest*:

  * `Message.id := 3`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [1]`
  * `ConversationResponse.signature` is initialized with 16 bytes 0x40

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 4`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [2]`
  * `ConversationResponse.signature` is a signature of `AddRelatedIdentityRequest.cardApplication` with XORed first byte with 0x12

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 5`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [3]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 6`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [3]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 7`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId` is initialized with 16 bytes 0x40
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [4]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 8`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId` and XOR its first byte with 0x12
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [5]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 9`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := []`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 10`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId` is initialized with 40 bytes 0x40
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 11`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is first 10 bytes of a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [6]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 12`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer with XORed first byte with 0x12
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [7]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 13`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is first 20 bytes of a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [8]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 14`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer with XORed first byte with 0x12
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [9]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 


and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 15`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is first 20 bytes of a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [10]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 16`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a hash of the relationship card as defined in the protocol with XORed first byte with 0x12
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [11]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 17`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is first 20 bytes of a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [12]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 18`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity with XORed first byte with 0x12
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [13]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 19`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 1479220555000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [14]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 20`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type` is initialized with 70x 'a'
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [15]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 21`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type` is initialized with 35x 'É' (UTF8 code 0xc990), which consumes 2 bytes per character
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [16]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 


and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 22`
  * `AddRelatedIdentityRequest.signedCard.card.version := [0,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [17]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 23`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [18]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 24`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [19]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 

and reads the response. Then it sends *AddRelatedIdentityRequest*

  * `Message.id := 25`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is initialized with 130 bytes 0x40
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [20]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication` 




###### Step 3:


Then it sends *RemoveRelatedIdentityRequest*:

  * `Message.id := 26`
  * `RemoveRelatedIdentityRequest.applicationId := [21]`

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 27`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type` is initialized with 70x 'a'
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response. Then it sends *GetIdentityRelationshipsInformationRequest*:

  * `Message.id := 28`
  * `SingleRequest.version := [1,0,0]`
  * `GetIdentityRelationshipsInformationRequest.identityNetworkId` is set to the primary test's identity ID
  * `GetIdentityRelationshipsInformationRequest.includeInvalid := true`
  * `GetIdentityRelationshipsInformationRequest.type` is initialized with 35x 'É' (UTF8 code 0xc990), which consumes 2 bytes per character
  * `GetIdentityRelationshipsInformationRequest.specificIssuer := false`
  * `GetIdentityRelationshipsInformationRequest.issuerNetworkId` is uninitialized

and reads the response.

  
##### Acceptance Criteria


###### Step 1:

The test successfully obtains list of ports on which the profile server provides its services. 
Then the test successfully establishes hosting agreements for its primary and secondary identities.
Then the test successfully checks-in both identities.


###### Step 2:

Server replies with *Response*:

  * `Message.id := 3`
  * `Response.status == ERROR_INVALID_SIGNATURE`


Server replies with *Response*:

  * `Message.id := 4`
  * `Response.status == ERROR_INVALID_SIGNATURE`


Server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 5`
  * `Response.status == STATUS_OK`


Server replies with *Response*:

  * `Message.id := 6`
  * `Response.status == ERROR_ALREADY_EXISTS`


Server replies with *Response*:

  * `Message.id := 7`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "cardApplication.cardId"`


Server replies with *Response*:

  * `Message.id := 8`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "cardApplication.cardId"`


Server replies with *Response*:

  * `Message.id := 9`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "cardApplication.applicationId"`


Server replies with *Response*:

  * `Message.id := 10`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "cardApplication.applicationId"`


Server replies with *Response*:

  * `Message.id := 11`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.issuerSignature"`

Server replies with *Response*:

  * `Message.id := 12`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.issuerSignature"`

Server replies with *Response*:

  * `Message.id := 13`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.issuerSignature"`

Server replies with *Response*:

  * `Message.id := 14`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.issuerSignature"`

Server replies with *Response*:

  * `Message.id := 15`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.cardId"`

Server replies with *Response*:

  * `Message.id := 16`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.cardId"`

Server replies with *Response*:

  * `Message.id := 17`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.recipientPublicKey"`

Server replies with *Response*:

  * `Message.id := 18`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.recipientPublicKey"`

Server replies with *Response*:

  * `Message.id := 19`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.validFrom"`

Server replies with *Response*:

  * `Message.id := 20`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.type"`

Server replies with *Response*:

  * `Message.id := 21`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.type"`

Server replies with *Response*:

  * `Message.id := 22`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.version"`

Server replies with *Response*:

  * `Message.id := 23`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.version"`

Server replies with *Response*:

  * `Message.id := 24`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.version"`

Server replies with *Response*:

  * `Message.id := 25`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "signedCard.card.issuerPublicKey"`



###### Step 3:

Server replies with *Response*:

  * `Message.id := 26`
  * `Response.status == ERROR_NOT_FOUND`

Server replies with *Response*:

  * `Message.id := 27`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "type"`

Server replies with *Response*:

  * `Message.id := 28`
  * `Response.status == ERROR_INVALID_VALUE`
  * `Response.details == "type"`






#### PS07003 - Add Related Identity - Quota Exceeded

##### Prerequisites/Inputs

###### Prerequisites:
  * Server's database is empty.
  * Server's maximum number of related identities is set to 100.

###### Inputs:
  * Server's IP address
  * Server's primary port


##### Description 

The test adds too many related identities.


###### Step 1:

The tests obtains a list of service ports from the profile server's primary port.
The test creates a primary identity, for which it establishes a hosting agreement and checks it in.
Then it creates another identities (called Issuer), which it uses for issuing relationship cards.


###### Step 2:

The test then sends 101 *AddRelatedIdentityRequest* requests (for $i = 0 to 100):

  * `Message.id := $i + 1`
  * `AddRelatedIdentityRequest.signedCard.card.version := [1,0,0]`
  * `AddRelatedIdentityRequest.signedCard.card.type := "Card Type A"`
  * `AddRelatedIdentityRequest.signedCard.card.validFrom := 1479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.validTo := 2479220556000`
  * `AddRelatedIdentityRequest.signedCard.card.issuerPublicKey` is a public key of Issuer
  * `AddRelatedIdentityRequest.signedCard.card.recipientPublicKey` is a public key of test's primary identity
  * `AddRelatedIdentityRequest.signedCard.card.cardId` is a valid hash of the relationship card as defined in the protocol
  * `AddRelatedIdentityRequest.signedCard.issuerSignature` is a valid signature of `AddRelatedIdentityRequest.signedCard.card.cardId` by Issuer
  * `AddRelatedIdentityRequest.cardApplication.cardId := AddRelatedIdentityRequest.signedCard.card.cardId`
  * `AddRelatedIdentityRequest.cardApplication.applicationId := [$i]`
  * `ConversationResponse.signature` is a valid signature of `AddRelatedIdentityRequest.cardApplication`



##### Acceptance Criteria


###### Step 1:

The test successfully obtains list of ports on which the profile server provides its services. 
Then the test successfully establishes a hosting agreement for its primary identity.
Then the test successfully checks-in both identities.


###### Step 2:

For the first 100 cards, server replies with *AddRelatedIdentityResponse*:

  * `Message.id := 3`
  * `Response.status == STATUS_OK`


For the 101st card, server replies with *Response*:

  * `Message.id := 3`
  * `Response.status == ERROR_QUOTA_EXCEEDED`


